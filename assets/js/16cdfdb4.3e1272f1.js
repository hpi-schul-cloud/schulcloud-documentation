"use strict";(self.webpackChunkdataport_docusaurus=self.webpackChunkdataport_docusaurus||[]).push([[7975],{7843:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>l,default:()=>u,frontMatter:()=>s,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"backend-design-patterns/Configuration","title":"ConfigurationModule Usage Guide","description":"The ConfigurationModule provides a flexible and type-safe way to manage application configuration. It supports environment variables, validation, and custom decorators for easy access to configuration values.","source":"@site/docs/backend-design-patterns/Configuration.md","sourceDirName":"backend-design-patterns","slug":"/backend-design-patterns/Configuration","permalink":"/docs/backend-design-patterns/Configuration","draft":false,"unlisted":false,"editUrl":"https://github.com/hpi-schul-cloud/hpi-schul-cloud.github.io/blob/main/docs/backend-design-patterns/Configuration.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Using the API of a Mikroservice","permalink":"/docs/backend-design-patterns/Coding-Guidelines/using-mikroservice-apis"},"next":{"title":"Software Architecture","permalink":"/docs/backend-design-patterns/architecture"}}');var r=i(4848),t=i(8453);const s={},l="ConfigurationModule Usage Guide",a={},c=[{value:"\u2705 Why Use ConfigurationModule?",id:"-why-use-configurationmodule",level:2},{value:"\u274c Forbidden Practices",id:"-forbidden-practices",level:2},{value:"1. Creating a Configuration Class",id:"1-creating-a-configuration-class",level:2},{value:"2. Registering the ConfigurationModule",id:"2-registering-the-configurationmodule",level:2},{value:"3. Injecting and Using the Configuration",id:"3-injecting-and-using-the-configuration",level:2},{value:"4. Environment Variables",id:"4-environment-variables",level:2},{value:"<code>.env.default</code>",id:"envdefault",level:3},{value:"<code>.env.test</code>",id:"envtest",level:3},{value:"<code>.env</code> (local)",id:"env-local",level:3},{value:"5. Validation and Transformation",id:"5-validation-and-transformation",level:2},{value:"5.1. Basic Type Validation",id:"51-basic-type-validation",level:3},{value:"5.2. URL Validation",id:"52-url-validation",level:3},{value:"5.3. Optional Properties",id:"53-optional-properties",level:3},{value:"5.4. Conditional Validation",id:"54-conditional-validation",level:3},{value:"5.5. Enum Validation",id:"55-enum-validation",level:3},{value:"5.6. Array Validation",id:"56-array-validation",level:3},{value:"6. PublicApiConfig Pattern",id:"6-publicapiconfig-pattern",level:2},{value:"6.1. Passing Configuration to Client Applications",id:"61-passing-configuration-to-client-applications",level:3},{value:"Available Endpoints",id:"available-endpoints",level:4},{value:"6.2. Creating a PublicApiConfig Class",id:"62-creating-a-publicapiconfig-class",level:3},{value:"6.3. Export from Module Index",id:"63-export-from-module-index",level:3},{value:"6.4. Register in Server Module",id:"64-register-in-server-module",level:3},{value:"6.5. Adding to ConfigResponse",id:"65-adding-to-configresponse",level:3},{value:"Step 1: Add Import to config.response.ts",id:"step-1-add-import-to-configresponsets",level:4},{value:"Step 2: Add Properties to ConfigResponse Class",id:"step-2-add-properties-to-configresponse-class",level:4},{value:"Step 3: Add to Constructor Type and Assignment",id:"step-3-add-to-constructor-type-and-assignment",level:4},{value:"Step 4: Update ServerUc",id:"step-4-update-serveruc",level:4},{value:"Step 5: Update ConfigResponseMapper",id:"step-5-update-configresponsemapper",level:4},{value:"6.6. Best Practices for PublicApiConfig",id:"66-best-practices-for-publicapiconfig",level:3},{value:"7. Best Practices",id:"7-best-practices",level:2},{value:"7.1. Module-Level Configuration",id:"71-module-level-configuration",level:3},{value:"7.2. Infrastructure Module Pattern",id:"72-infrastructure-module-pattern",level:3},{value:"7.3. Default Configuration with Interface Pattern",id:"73-default-configuration-with-interface-pattern",level:3},{value:"7.4. Module Options Pattern",id:"74-module-options-pattern",level:3},{value:"7.5. Timeout Configuration Pattern",id:"75-timeout-configuration-pattern",level:3},{value:"8. Summary",id:"8-summary",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"configurationmodule-usage-guide",children:"ConfigurationModule Usage Guide"})}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"ConfigurationModule"})," provides a flexible and type-safe way to manage application configuration. It supports environment variables, validation, and custom decorators for easy access to configuration values."]}),"\n",(0,r.jsx)(n.h2,{id:"-why-use-configurationmodule",children:"\u2705 Why Use ConfigurationModule?"}),"\n",(0,r.jsx)(n.p,{children:"The ConfigurationModule offers several key advantages over traditional configuration approaches:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Module Encapsulation Principle"}),": Environment variables should be defined in the modules they belong to (e.g., board features in ",(0,r.jsx)(n.code,{children:"board.config.ts"}),", team features in ",(0,r.jsx)(n.code,{children:"team.config.ts"}),"). This ensures better encapsulation, clearer ownership, and easier maintenance. Only add general server-wide configuration to ",(0,r.jsx)(n.code,{children:"server.config.ts"})," if it doesn't belong to any specific module."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Type Safety"}),": Configuration values are strongly typed with TypeScript, preventing runtime errors caused by type mismatches."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Validation"}),": Uses class-validator decorators (",(0,r.jsx)(n.code,{children:"@IsBoolean"}),", ",(0,r.jsx)(n.code,{children:"@IsString"}),", ",(0,r.jsx)(n.code,{children:"@IsUrl"}),", etc.) to ensure configuration values meet expected formats at runtime."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Transformation"}),': Automatically converts environment variables (e.g., string "true"/"false" to boolean) using transformers like ',(0,r.jsx)(n.code,{children:"@StringToBoolean()"}),"."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Default Values"}),": Properties can have sensible defaults, reducing the number of required environment variables."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Discoverability"}),": All configuration options are clearly visible in one place with their types, making it easy for developers to understand what can be configured."]}),"\n"]}),"\n",(0,r.jsxs)(n.li,{children:["\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Maintainability"}),": Changes to configuration structure are easier to track and refactor across the codebase."]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"-forbidden-practices",children:"\u274c Forbidden Practices"}),"\n",(0,r.jsxs)(n.p,{children:["When using the ConfigurationModule, the following practices are ",(0,r.jsx)(n.strong,{children:"forbidden"})," and should be avoided:"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Direct ",(0,r.jsx)(n.code,{children:"process.env"})," access"]}),": Never use ",(0,r.jsx)(n.code,{children:"process.env.VARIABLE_NAME"})," directly in your code. This bypasses validation, type safety, and defaults."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["Legacy ",(0,r.jsx)(n.code,{children:"Configuration.get()"})]}),": Do not use the old ",(0,r.jsx)(n.code,{children:"Configuration.get()"})," method. This is deprecated and doesn't provide type safety."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsxs)(n.strong,{children:["NestJS ",(0,r.jsx)(n.code,{children:"ConfigService"})]}),": Avoid using NestJS's built-in ",(0,r.jsx)(n.code,{children:"ConfigService"}),". Use the ConfigurationModule pattern instead for consistency and better type safety."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"These approaches lack the validation, transformation, and type safety benefits that the ConfigurationModule provides."}),"\n",(0,r.jsx)(n.h2,{id:"1-creating-a-configuration-class",children:"1. Creating a Configuration Class"}),"\n",(0,r.jsxs)(n.p,{children:["Define a class to represent your configuration in your module with ",(0,r.jsx)(n.code,{children:"@Configuration()"}),". Use the ",(0,r.jsx)(n.code,{children:"@ConfigProperty"})," decorator to mark properties that should be loaded from environment variables or other sources:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { ConfigProperty, Configuration } from '@infra/configuration';\nimport { IsBoolean, IsNumber } from 'class-validator';\nimport { StringToBoolean, StringToNumber } from '@shared/controller/transformer';\n\nexport const MY_FEATURE_CONFIG_TOKEN = 'MY_FEATURE_CONFIG_TOKEN';\n\n@Configuration()\nexport class MyFeatureConfig {\n  @IsBoolean()\n  @StringToBoolean()\n  @ConfigProperty('MY_FEATURE_ENABLED')\n  public readonly enabled!: boolean;\n\n  @IsNumber()\n  @StringToNumber()\n  @ConfigProperty('MY_FEATURE_TIMEOUT')\n  public readonly timeout = 3000;\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"2-registering-the-configurationmodule",children:"2. Registering the ConfigurationModule"}),"\n",(0,r.jsxs)(n.p,{children:["Import and add the ",(0,r.jsx)(n.code,{children:"ConfigurationModule"})," to your feature or root module:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { Module } from '@nestjs/common';\nimport { ConfigurationModule } from '@infra/configuration';\nimport { MyFeatureConfig, MY_FEATURE_CONFIG_TOKEN } from './my-feature.config';\n\n@Module({\n  imports: [ConfigurationModule.register(MY_FEATURE_CONFIG_TOKEN, MyFeatureConfig)],\n})\nexport class AppModule {}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"3-injecting-and-using-the-configuration",children:"3. Injecting and Using the Configuration"}),"\n",(0,r.jsx)(n.p,{children:"Inject your configuration class into services or controllers as needed:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { Inject, Injectable } from '@nestjs/common';\nimport { MyFeatureConfig, MY_FEATURE_CONFIG_TOKEN } from './my-feature.config';\n\n@Injectable()\nexport class MyFeatureService {\n  constructor(@Inject(MY_FEATURE_CONFIG_TOKEN) private readonly config: MyFeatureConfig) {}\n\n  doSomething() {\n    if (this.config.enabled) {\n      // ...\n    }\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"4-environment-variables",children:"4. Environment Variables"}),"\n",(0,r.jsx)(n.p,{children:"The project uses multiple environment variable files to manage different deployment scenarios:"}),"\n",(0,r.jsx)(n.h3,{id:"envdefault",children:(0,r.jsx)(n.code,{children:".env.default"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),": Contains default values for all locally configured properties"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"When to use"}),": Provides a template for developers"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Content"}),": Safe default values that work for local development"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Committed"}),": Yes, this file is committed to version control"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Example from .env.default\nSESSION_VALKEY__MODE=in-memory\nSC_DOMAIN=localhost\nALERT_STATUS_URL=https://status.dbildungscloud.dev/\n"})}),"\n",(0,r.jsx)(n.h3,{id:"envtest",children:(0,r.jsx)(n.code,{children:".env.test"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),": Configuration specifically for test environments"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"When to use"}),": Automatically loaded during test execution"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Content"}),": Test-specific values (test databases, mock endpoints, simplified settings)"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Committed"}),": Yes, safe for version control as it contains only test configuration"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Example from .env.test\nAES_KEY=test-key-with-32-characters-long\nADMIN_API__ALLOWED_API_KEYS=onlyusedintests:thisistheadminapitokeninthetestconfig\n"})}),"\n",(0,r.jsxs)(n.h3,{id:"env-local",children:[(0,r.jsx)(n.code,{children:".env"})," (local)"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Purpose"}),": Your personal development environment overrides"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"When to use"}),": Override defaults with your local development settings"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Content"}),": Personal API keys, local service URLs, custom feature flags"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Committed"}),": No, this file is in ",(0,r.jsx)(n.code,{children:".gitignore"})," and should not be committed"]}),"\n"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Example .env (create this file locally)\nMY_FEATURE_ENABLED=true\nMY_FEATURE_TIMEOUT=5000\nDATABASE_URL=postgresql://localhost:5432/mylocal_db\nAPI_KEY=your-personal-development-key\n"})}),"\n",(0,r.jsx)(n.h2,{id:"5-validation-and-transformation",children:"5. Validation and Transformation"}),"\n",(0,r.jsx)(n.p,{children:"The ConfigurationModule supports comprehensive validation and transformation using class-validator decorators and custom transformers. This ensures that configuration values are correctly typed, validated, and transformed from environment variable strings."}),"\n",(0,r.jsx)(n.h3,{id:"51-basic-type-validation",children:"5.1. Basic Type Validation"}),"\n",(0,r.jsx)(n.p,{children:"Use these decorators for basic type validation:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { IsBoolean, IsNumber, IsString, IsInt } from 'class-validator';\nimport { StringToBoolean, StringToNumber } from '@shared/controller/transformer';\n\n@Configuration()\nexport class MyConfig {\n  @IsBoolean()\n  @StringToBoolean()\n  @ConfigProperty('FEATURE_ENABLED')\n  public featureEnabled = false;\n\n  @IsNumber()\n  @StringToNumber()\n  @ConfigProperty('TIMEOUT_MS')\n  public timeoutMs = 5000;\n\n  @IsString()\n  @ConfigProperty('API_KEY')\n  public apiKey!: string;\n\n  @IsInt()\n  @StringToNumber()\n  @ConfigProperty('MAX_CONNECTIONS')\n  public maxConnections = 100;\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"52-url-validation",children:"5.2. URL Validation"}),"\n",(0,r.jsxs)(n.p,{children:["For URL properties, use ",(0,r.jsx)(n.code,{children:"@IsUrl()"})," with appropriate options:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { IsUrl } from 'class-validator';\n\n@Configuration()\nexport class ServiceConfig {\n  @IsUrl({ require_tld: false }) // Allow localhost URLs\n  @ConfigProperty('SERVICE_URL')\n  public serviceUrl = 'http://localhost:3000';\n\n  @IsUrl() // Require valid TLD for production URLs\n  @ConfigProperty('EXTERNAL_API_URL')\n  public externalApiUrl!: string;\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"53-optional-properties",children:"5.3. Optional Properties"}),"\n",(0,r.jsx)(n.p,{children:"Mark properties as optional when they may not be provided:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { IsOptional, IsString } from 'class-validator';\n\n@Configuration()\nexport class OptionalConfig {\n  @IsOptional()\n  @IsString()\n  @ConfigProperty('OPTIONAL_SETTING')\n  public optionalSetting?: string;\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"54-conditional-validation",children:"5.4. Conditional Validation"}),"\n",(0,r.jsxs)(n.p,{children:["Use ",(0,r.jsx)(n.code,{children:"@ValidateIf()"})," to validate properties only when certain conditions are met:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { ValidateIf, IsString, IsBoolean } from 'class-validator';\nimport { StringToBoolean } from '@shared/controller/transformer';\n\n@Configuration()\nexport class ConditionalConfig {\n  @IsBoolean()\n  @StringToBoolean()\n  @ConfigProperty('FEATURE_ENABLED')\n  public featureEnabled = false;\n\n  @ValidateIf((config: ConditionalConfig) => config.featureEnabled)\n  @IsString()\n  @ConfigProperty('FEATURE_API_KEY')\n  public featureApiKey?: string;\n\n  @ValidateIf((config: ConditionalConfig) => config.featureEnabled)\n  @IsUrl({ require_tld: false })\n  @ConfigProperty('FEATURE_SERVICE_URL')\n  public featureServiceUrl?: string;\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"55-enum-validation",children:"5.5. Enum Validation"}),"\n",(0,r.jsx)(n.p,{children:"Validate against specific enum values:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { IsEnum } from 'class-validator';\n\nenum LogLevel {\n  ERROR = 'error',\n  WARN = 'warn',\n  INFO = 'info',\n  DEBUG = 'debug',\n}\n\n@Configuration()\nexport class LoggingConfig {\n  @IsEnum(LogLevel)\n  @ConfigProperty('LOG_LEVEL')\n  public logLevel = LogLevel.INFO;\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"56-array-validation",children:"5.6. Array Validation"}),"\n",(0,r.jsx)(n.p,{children:"For array properties:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { IsArray, IsString } from 'class-validator';\n\n@Configuration()\nexport class ArrayConfig {\n  @IsArray()\n  @IsString({ each: true })\n  @ConfigProperty('ALLOWED_ORIGINS')\n  public allowedOrigins: string[] = ['http://localhost:3000'];\n}\n"})}),"\n",(0,r.jsx)(n.h2,{id:"6-publicapiconfig-pattern",children:"6. PublicApiConfig Pattern"}),"\n",(0,r.jsxs)(n.p,{children:["The ",(0,r.jsx)(n.code,{children:"PublicApiConfig"})," pattern allows modules to expose their configuration values to the public API endpoint ",(0,r.jsx)(n.code,{children:"/config/public"}),". This is useful for client applications that need to know about certain feature flags or configuration values."]}),"\n",(0,r.jsx)(n.h3,{id:"61-passing-configuration-to-client-applications",children:"6.1. Passing Configuration to Client Applications"}),"\n",(0,r.jsx)(n.p,{children:"The PublicApiConfig pattern exposes server configuration to client applications through public API endpoints. Client applications can fetch this configuration during startup to determine feature flags, non-sensitive service URLs, UI settings, and localization options\u2014without requiring environment-specific builds."}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\u26a0\ufe0f Security Warning"}),": Never expose secrets through this endpoint, as the data is readable in the browser and in request/response traffic."]}),"\n",(0,r.jsx)(n.h4,{id:"available-endpoints",children:"Available Endpoints"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Main config endpoint"}),": ",(0,r.jsx)(n.code,{children:"http://{{HOST}}:{{PORT}}/api/v3/config/public"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Files config endpoint"}),": ",(0,r.jsx)(n.code,{children:"http://{{HOST}}:{{PORT}}/api/v3/files/config/public"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:["The endpoints are implemented in the ",(0,r.jsx)(n.a,{href:"https://github.com/hpi-schul-cloud/schulcloud-server/blob/main/apps/server/src/modules/server/api/server-config.controller.ts",children:"ServerConfigController"}),", which aggregates all registered PublicApiConfig classes."]}),"\n",(0,r.jsx)(n.h3,{id:"62-creating-a-publicapiconfig-class",children:"6.2. Creating a PublicApiConfig Class"}),"\n",(0,r.jsx)(n.p,{children:"Create a separate configuration class containing only the properties you want to expose publicly:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// my-feature.config.ts\nimport { ConfigProperty, Configuration } from '@infra/configuration';\nimport { StringToBoolean } from '@shared/controller/transformer';\nimport { IsBoolean } from 'class-validator';\n\nexport const MY_FEATURE_PUBLIC_API_CONFIG_TOKEN = 'MY_FEATURE_PUBLIC_API_CONFIG_TOKEN';\n\n@Configuration()\nexport class MyFeaturePublicApiConfig {\n  @ConfigProperty('FEATURE_MY_FEATURE_ENABLED')\n  @IsBoolean()\n  @StringToBoolean()\n  public featureMyFeatureEnabled = false;\n}\n\n// Optional: Extend for full configuration with private settings\nexport const MY_FEATURE_CONFIG_TOKEN = 'MY_FEATURE_CONFIG_TOKEN';\n\n@Configuration()\nexport class MyFeatureConfig extends MyFeaturePublicApiConfig {\n  @ConfigProperty('MY_FEATURE_PRIVATE_KEY')\n  @IsString()\n  public privateKey!: string; // Not exposed publicly\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"63-export-from-module-index",children:"6.3. Export from Module Index"}),"\n",(0,r.jsx)(n.p,{children:"Export your PublicApiConfig from your module's index file:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// modules/my-feature/index.ts\nexport { MY_FEATURE_PUBLIC_API_CONFIG_TOKEN, MyFeaturePublicApiConfig } from './my-feature.config';\nexport { MyFeatureModule } from './my-feature.module';\n"})}),"\n",(0,r.jsx)(n.h3,{id:"64-register-in-server-module",children:"6.4. Register in Server Module"}),"\n",(0,r.jsx)(n.p,{children:"Register the PublicApiConfig in your module's API module (if you have one):"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// my-feature-api.module.ts\nimport { ConfigurationModule } from '@infra/configuration';\nimport { MY_FEATURE_PUBLIC_API_CONFIG_TOKEN, MyFeaturePublicApiConfig } from './my-feature.config';\n\n@Module({\n  imports: [\n    ConfigurationModule.register(MY_FEATURE_PUBLIC_API_CONFIG_TOKEN, MyFeaturePublicApiConfig),\n  ],\n})\nexport class MyFeatureApiModule {}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"65-adding-to-configresponse",children:"6.5. Adding to ConfigResponse"}),"\n",(0,r.jsx)(n.p,{children:"To make your module's configuration available through the public config API, you need to modify several files:"}),"\n",(0,r.jsx)(n.h4,{id:"step-1-add-import-to-configresponsets",children:"Step 1: Add Import to config.response.ts"}),"\n",(0,r.jsxs)(n.p,{children:["Add the import for your PublicApiConfig to ",(0,r.jsx)(n.code,{children:"apps/server/src/modules/server/api/dto/config.response.ts"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { MyFeaturePublicApiConfig } from '@modules/my-feature';\n"})}),"\n",(0,r.jsx)(n.h4,{id:"step-2-add-properties-to-configresponse-class",children:"Step 2: Add Properties to ConfigResponse Class"}),"\n",(0,r.jsxs)(n.p,{children:["Add the properties you want to expose to the ",(0,r.jsx)(n.code,{children:"ConfigResponse"})," class:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"export class ConfigResponse {\n  // ... existing properties ...\n\n  @ApiProperty()\n  FEATURE_MY_FEATURE_ENABLED: boolean;\n\n  // ... rest of properties ...\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"step-3-add-to-constructor-type-and-assignment",children:"Step 3: Add to Constructor Type and Assignment"}),"\n",(0,r.jsx)(n.p,{children:"Update the constructor parameter type and assignment:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"export class ConfigResponse {\n  constructor(\n    config: ServerConfig &\n      VideoConferencePublicApiConfig &\n      // ... other existing PublicApiConfigs &\n      MyFeaturePublicApiConfig // Add your config here\n  ) {\n    // ... existing assignments ...\n    this.FEATURE_MY_FEATURE_ENABLED = config.featureMyFeatureEnabled;\n    // ... rest of assignments ...\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"step-4-update-serveruc",children:"Step 4: Update ServerUc"}),"\n",(0,r.jsxs)(n.p,{children:["Add your config to the ",(0,r.jsx)(n.code,{children:"ServerUc"})," constructor and getConfig method:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"@Injectable()\nexport class ServerUc {\n  constructor(\n    // ... existing configs ...\n    @Inject(MY_FEATURE_PUBLIC_API_CONFIG_TOKEN) \n    private readonly myFeatureConfig: MyFeaturePublicApiConfig\n  ) {}\n\n  public getConfig(): ConfigResponse {\n    const configDto = ConfigResponseMapper.mapToResponse(\n      this.config,\n      // ... existing configs ...\n      this.myFeatureConfig\n    );\n\n    return configDto;\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h4,{id:"step-5-update-configresponsemapper",children:"Step 5: Update ConfigResponseMapper"}),"\n",(0,r.jsxs)(n.p,{children:["Update the ",(0,r.jsx)(n.code,{children:"ConfigResponseMapper"}),":"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"export class ConfigResponseMapper {\n  public static mapToResponse(\n    serverConfig: ServerConfig,\n    // ... existing configs ...\n    myFeatureConfig: MyFeaturePublicApiConfig\n  ): ConfigResponse {\n    const configResponse = new ConfigResponse({\n      ...serverConfig,\n      // ... existing configs ...\n      ...myFeatureConfig,\n    });\n\n    return configResponse;\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"66-best-practices-for-publicapiconfig",children:"6.6. Best Practices for PublicApiConfig"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Only expose necessary values"}),": Don't include sensitive information like API keys or secrets"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Use descriptive names"}),": Follow the pattern ",(0,r.jsx)(n.code,{children:"FEATURE_[MODULE]_[FEATURE]_ENABLED"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Consistent typing"}),": Use boolean for feature flags, strings for URLs, etc."]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Documentation"}),": Add ",(0,r.jsx)(n.code,{children:"@ApiProperty()"})," decorators with descriptions for Swagger documentation"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Default values"}),": Provide sensible defaults for all configuration properties"]}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"7-best-practices",children:"7. Best Practices"}),"\n",(0,r.jsx)(n.h3,{id:"71-module-level-configuration",children:"7.1. Module-Level Configuration"}),"\n",(0,r.jsx)(n.p,{children:"Each configuration class should be placed at the top level of its respective module whenever possible. This makes it easy to locate and manage module-specific settings."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"src/modules/my-feature/\n\u251c\u2500\u2500 my-feature.config.ts     // \u2190 Configuration at module root\n\u251c\u2500\u2500 my-feature.module.ts\n\u251c\u2500\u2500 index.ts\n\u2514\u2500\u2500 services/\n    \u2514\u2500\u2500 my-feature.service.ts\n"})}),"\n",(0,r.jsx)(n.h3,{id:"72-infrastructure-module-pattern",children:"7.2. Infrastructure Module Pattern"}),"\n",(0,r.jsxs)(n.p,{children:["Modules located in ",(0,r.jsx)(n.code,{children:"apps/server/src/infra"})," should always receive their configuration from the outside as arguments to their ",(0,r.jsx)(n.code,{children:"register()"})," function. This promotes reusability and decoupling."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Example from apps/server/src/infra/calendar/calendar.module.ts\n@Module({})\nexport class CalendarModule {\n  public static register(injectionToken: string, Constructor: new () => CalendarConfig): DynamicModule {\n    return {\n      module: CalendarModule,\n      imports: [HttpModule, CqrsModule, LoggerModule, ConfigurationModule.register(injectionToken, Constructor)],\n      providers: [CalendarMapper, CalendarService],\n      exports: [CalendarService],\n    };\n  }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"This pattern allows the consuming module to provide the appropriate configuration:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Usage in a business module\n@Module({\n  imports: [\n    CalendarModule.register(MY_CALENDAR_CONFIG_TOKEN, MyCalendarConfig),\n  ],\n})\nexport class MyBusinessModule {}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"73-default-configuration-with-interface-pattern",children:"7.3. Default Configuration with Interface Pattern"}),"\n",(0,r.jsx)(n.p,{children:"For more flexibility, infrastructure modules often provide a default configuration class alongside an internal interface. This approach allows consumers to either use the provided default configuration or implement their own custom configuration while maintaining type safety. The interface ensures all implementations provide the necessary properties with the correct types."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Example: apps/server/src/infra/schulconnex-client/schulconnex-client.config.ts\nexport interface InternalSchulconnexClientConfig {\n  personInfoTimeoutInMs: number;\n  apiUrl?: string;\n  clientId?: string;\n}\n\n/**\n * Default configuration for the SchulconnexClient.\n * Create your own config class implementing InternalSchulconnexClientConfig\n * if you need different environment variables or behavior.\n */\n@Configuration()\nexport class SchulconnexClientConfig implements InternalSchulconnexClientConfig {\n  @ConfigProperty('SCHULCONNEX_CLIENT__PERSON_INFO_TIMEOUT_IN_MS')\n  @StringToNumber()\n  @IsNumber()\n  public personInfoTimeoutInMs = 3000;\n\n  @ConfigProperty('SCHULCONNEX_CLIENT__API_URL')\n  @IsOptional()\n  @IsString()\n  public apiUrl?: string;\n\n  @ConfigProperty('SCHULCONNEX_CLIENT__CLIENT_ID')\n  @IsOptional()\n  @IsString()\n  public clientId?: string;\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"The module accepts any constructor implementing the interface:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"export class SchulconnexClientModule {\n  public static register(\n    injectionToken: string,\n    Constructor: new () => InternalSchulconnexClientConfig\n  ): DynamicModule {\n    // ... module configuration\n  }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"For complete encapsulation, the infrastructure module's internal services should depend only on the interface, not the concrete configuration class. This ensures type safety and flexibility while keeping the module decoupled from specific implementations."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Internal service using the interface\n@Injectable()\nexport class SchulconnexRestClient {\n  constructor(\n    @Inject(SCHULCONNEX_CLIENT_CONFIG_TOKEN) \n    private readonly config: InternalSchulconnexClientConfig // \u2190 Interface type\n  ) {}\n\n  async getPersonInfo(): Promise<PersonInfo> {\n    const timeout = this.config.personInfoTimeoutInMs;\n    // Implementation works with any config satisfying the interface\n  }\n}\n"})}),"\n",(0,r.jsx)(n.h3,{id:"74-module-options-pattern",children:"7.4. Module Options Pattern"}),"\n",(0,r.jsx)(n.p,{children:"When an infrastructure module requires more than one injection token and constructor (i.e., multiple configuration dependencies), introduce a module options interface to keep the API clean and organized."}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Example: apps/server/src/infra/tsp-client/types/module-options.ts\nexport interface TspClientModuleOptions {\n  encryptionConfig: { configInjectionToken: string; configConstructor: new () => EncryptionConfig };\n  tspClientConfig: { configInjectionToken: string; configConstructor: new () => TspClientConfig };\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"Use this options interface in your infrastructure module's register method:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Example: apps/server/src/infra/tsp-client/tsp-client.module.ts\n@Module({})\nexport class TspClientModule {\n  public static register(options: TspClientModuleOptions): DynamicModule {\n    const { encryptionConfig, tspClientConfig } = options;\n    return {\n      module: TspClientModule,\n      imports: [\n        LoggerModule,\n        OauthAdapterModule,\n        EncryptionModule.register(encryptionConfig.configConstructor, encryptionConfig.configInjectionToken),\n        ConfigurationModule.register(tspClientConfig.configInjectionToken, tspClientConfig.configConstructor),\n      ],\n      providers: [TspClientFactory],\n      exports: [TspClientFactory],\n    };\n  }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:"This pattern provides several benefits:"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Clean API"}),": Single parameter instead of multiple individual parameters"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Type Safety"}),": All required configurations are defined in the interface"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Maintainability"}),": Easy to add new configuration dependencies"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Self-Documentation"}),": The interface clearly shows all required dependencies"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"75-timeout-configuration-pattern",children:"7.5. Timeout Configuration Pattern"}),"\n",(0,r.jsxs)(n.p,{children:["For modules that need custom request timeouts, use the special timeout configuration pattern. Timeout configurations extend the ",(0,r.jsx)(n.code,{children:"TimeoutConfig"})," base class and provide configurable timeout values for specific endpoints."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"// Example: apps/server/src/modules/room/timeout.config.ts\nimport { TimeoutConfig } from '@core/interceptor/timeout-interceptor-config.interface';\nimport { ConfigProperty, Configuration } from '@infra/configuration';\nimport { StringToNumber } from '@shared/controller/transformer';\nimport { IsNumber } from 'class-validator';\n\nexport const ROOM_TIMEOUT_CONFIG_TOKEN = 'ROOM_TIMEOUT_CONFIG_TOKEN';\nexport const ROOM_INCOMING_REQUEST_TIMEOUT_COPY_API_KEY = 'roomIncomingRequestTimeoutCopyApi';\n\n@Configuration()\nexport class RoomTimeoutConfig extends TimeoutConfig {\n  @ConfigProperty('INCOMING_REQUEST_TIMEOUT_COPY_API')\n  @IsNumber()\n  @StringToNumber()\n  public [ROOM_INCOMING_REQUEST_TIMEOUT_COPY_API_KEY] = 60000;\n}\n"})}),"\n",(0,r.jsxs)(n.p,{children:["Use the ",(0,r.jsx)(n.code,{children:"@RequestTimeout"})," decorator on controller endpoints to apply custom timeouts. The decorator references the property key from your timeout configuration:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-typescript",children:"import { RequestTimeout } from '@shared/common/decorators/timeout.decorator';\n\n@Controller('rooms')\nexport class RoomController {\n  @RequestTimeout('roomIncomingRequestTimeoutCopyApi')\n  @Post('copy')\n  async copyRoom(): Promise<void> {\n    // This endpoint will use the configured timeout value\n  }\n}\n"})}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"Key Points:"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["Timeout configs must extend ",(0,r.jsx)(n.code,{children:"TimeoutConfig"})," base class"]}),"\n",(0,r.jsx)(n.li,{children:"Export property key constants for use with the decorator"}),"\n",(0,r.jsx)(n.li,{children:"Property keys should match the string values used in the decorator"}),"\n",(0,r.jsxs)(n.li,{children:["Register the timeout config with ",(0,r.jsx)(n.code,{children:"CoreModule.register()"})," in your module"]}),"\n",(0,r.jsx)(n.li,{children:"If a property doesn't exist, the interceptor falls back to default timeout"}),"\n"]}),"\n",(0,r.jsx)(n.h2,{id:"8-summary",children:"8. Summary"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Create a config class decorated with ",(0,r.jsx)(n.code,{children:"@Configuration()"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Use ",(0,r.jsx)(n.code,{children:"@ConfigProperty()"})," to bind properties to environment variables."]}),"\n",(0,r.jsxs)(n.li,{children:["Add validation decorators (",(0,r.jsx)(n.code,{children:"@IsBoolean"}),", ",(0,r.jsx)(n.code,{children:"@IsString"}),", etc.) and transformers (",(0,r.jsx)(n.code,{children:"@StringToBoolean"}),", ",(0,r.jsx)(n.code,{children:"@StringToNumber"}),")."]}),"\n",(0,r.jsxs)(n.li,{children:["Register the configuration using ",(0,r.jsx)(n.code,{children:"ConfigurationModule.register()"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Inject the configuration into your services using ",(0,r.jsx)(n.code,{children:"@Inject()"}),"."]}),"\n",(0,r.jsxs)(n.li,{children:["Set values via ",(0,r.jsx)(n.code,{children:".env"}),", ",(0,r.jsx)(n.code,{children:".env.default"}),", or ",(0,r.jsx)(n.code,{children:".env.test"})," files."]}),"\n",(0,r.jsxs)(n.li,{children:["For infrastructure modules, use the ",(0,r.jsx)(n.code,{children:"register()"})," pattern with external configuration."]}),"\n",(0,r.jsxs)(n.li,{children:["For public API exposure, create a separate ",(0,r.jsx)(n.code,{children:"PublicApiConfig"})," class and integrate it into the ",(0,r.jsx)(n.code,{children:"ConfigResponse"})," system."]}),"\n",(0,r.jsxs)(n.li,{children:["For custom timeouts, extend ",(0,r.jsx)(n.code,{children:"TimeoutConfig"})," and use the ",(0,r.jsx)(n.code,{children:"@RequestTimeout()"})," decorator."]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>s,x:()=>l});var o=i(6540);const r={},t=o.createContext(r);function s(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function l(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:s(e.components),o.createElement(t.Provider,{value:n},e.children)}}}]);