"use strict";(self.webpackChunkdataport_docusaurus=self.webpackChunkdataport_docusaurus||[]).push([[203],{3326:(e,i,r)=>{r.r(i),r.d(i,{assets:()=>o,contentTitle:()=>a,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>t});const s=JSON.parse('{"id":"services/h5p/Library management/scripts/build-h5p-libraries","title":"build-h5p-libraries.js","description":"Overview","source":"@site/docs/services/h5p/Library management/scripts/build-h5p-libraries.md","sourceDirName":"services/h5p/Library management/scripts","slug":"/services/h5p/Library management/scripts/build-h5p-libraries","permalink":"/docs/services/h5p/Library management/scripts/build-h5p-libraries","draft":false,"unlisted":false,"editUrl":"https://github.com/hpi-schul-cloud/hpi-schul-cloud.github.io/blob/main/docs/services/h5p/Library management/scripts/build-h5p-libraries.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"H5P library management service","permalink":"/docs/services/h5p/Library management/H5P library management service"},"next":{"title":"update-h5p-map.js","permalink":"/docs/services/h5p/Library management/scripts/update-h5p-map"}}');var n=r(4848),l=r(8453);const d={},a="build-h5p-libraries.js",o={},t=[{value:"Overview",id:"overview",level:2},{value:"How It Works",id:"how-it-works",level:2},{value:"Command-Line Options",id:"command-line-options",level:2},{value:"Usage Example",id:"usage-example",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Required Environment Variable",id:"required-environment-variable",level:2},{value:"Special Handling for H5P Library Versions During Build",id:"special-handling-for-h5p-library-versions-during-build",level:2},{value:"1. Libraries Requiring NODE_OPTIONS for Build",id:"1-libraries-requiring-node_options-for-build",level:3},{value:"2. Libraries Requiring Legacy Peer Dependencies for npm install",id:"2-libraries-requiring-legacy-peer-dependencies-for-npm-install",level:3},{value:"3. Libraries Requiring Path Correction in library.json",id:"3-libraries-requiring-path-correction-in-libraryjson",level:3},{value:"4. Libraries Excluded from Build Steps",id:"4-libraries-excluded-from-build-steps",level:3},{value:"How Special Handling is Applied",id:"how-special-handling-is-applied",level:3},{value:"Output",id:"output",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Related Files",id:"related-files",level:2}];function c(e){const i={code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(i.header,{children:(0,n.jsx)(i.h1,{id:"build-h5p-librariesjs",children:"build-h5p-libraries.js"})}),"\n",(0,n.jsx)(i.h2,{id:"overview",children:"Overview"}),"\n",(0,n.jsxs)(i.p,{children:[(0,n.jsx)(i.code,{children:"build-h5p-libraries.js"})," is a Node.js script used to automate the process of building H5P libraries from their respective GitHub repositories. It reads a list of desired libraries and a mapping of library names to repositories, then downloads and builds each library into a specified temporary folder."]}),"\n",(0,n.jsx)(i.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,n.jsxs)(i.ol,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Argument Parsing:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["Uses the ",(0,n.jsx)(i.code,{children:"arg"})," package to parse command-line arguments for input files and temporary folder."]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Configuration Files:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["Reads a YAML file containing the list of libraries to install (",(0,n.jsx)(i.code,{children:"--input"}),")."]}),"\n",(0,n.jsxs)(i.li,{children:["Reads a YAML file mapping library names to GitHub repositories (",(0,n.jsx)(i.code,{children:"--map"}),")."]}),"\n"]}),"\n"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.strong,{children:"Building Libraries:"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:["Instantiates ",(0,n.jsx)(i.code,{children:"H5pLibraryBuilderService"})," with the repo map and temp folder."]}),"\n",(0,n.jsx)(i.li,{children:"Downloads and builds each library listed in the wish list from its GitHub repository."}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,n.jsx)(i.h2,{id:"command-line-options",children:"Command-Line Options"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"--help"})," or ",(0,n.jsx)(i.code,{children:"-h"}),": Show usage information."]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"--input"})," or ",(0,n.jsx)(i.code,{children:"-i"}),": Path to the YAML file listing libraries to install (default: ",(0,n.jsx)(i.code,{children:"config/h5p-libraries.yaml"}),")."]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"--map"})," or ",(0,n.jsx)(i.code,{children:"-m"}),": Path to the YAML file mapping libraries to repositories (default: ",(0,n.jsx)(i.code,{children:"config/h5p-library-repo-map.yaml"}),")."]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"--tmp"})," or ",(0,n.jsx)(i.code,{children:"-t"}),": Path to the temporary folder for building libraries."]}),"\n"]}),"\n",(0,n.jsx)(i.h2,{id:"usage-example",children:"Usage Example"}),"\n",(0,n.jsx)(i.pre,{children:(0,n.jsx)(i.code,{className:"language-bash",children:"node scripts/h5p/build-h5p-libraries.js --input config/h5p-libraries.yaml --map config/h5p-library-repo-map.yaml --tmp /tmp/h5p-libraries\n"})}),"\n",(0,n.jsx)(i.p,{children:"If no options are provided, defaults are used for input and map files."}),"\n",(0,n.jsx)(i.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Node.js installed"}),"\n",(0,n.jsxs)(i.li,{children:["Required dependencies installed (run ",(0,n.jsx)(i.code,{children:"npm install"})," in the project root)"]}),"\n",(0,n.jsx)(i.li,{children:"Valid YAML files for library wish list and repo map"}),"\n"]}),"\n",(0,n.jsx)(i.h2,{id:"required-environment-variable",children:"Required Environment Variable"}),"\n",(0,n.jsxs)(i.p,{children:["To build H5P libraries using ",(0,n.jsx)(i.code,{children:"build-h5p-libraries.js"}),", you only need the following environment variable:"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"GITHUB_PERSONAL_ACCESS_TOKEN"}),": Required if you need to access private repositories or increase GitHub API rate limits. Set this variable to a valid GitHub personal access token."]}),"\n"]}),"\n",(0,n.jsx)(i.p,{children:"Set this variable in your environment before running the script to avoid authentication or permission errors."}),"\n",(0,n.jsx)(i.h2,{id:"special-handling-for-h5p-library-versions-during-build",children:"Special Handling for H5P Library Versions During Build"}),"\n",(0,n.jsxs)(i.p,{children:["This document lists all H5P library versions that require special handling during the build process in ",(0,n.jsx)(i.code,{children:"H5pLibraryBuilderService"}),"."]}),"\n",(0,n.jsx)(i.p,{children:(0,n.jsx)(i.strong,{children:"It needs to be checked from time to time if these handlings are still required and also are needed to be applied to newer versions!"})}),"\n",(0,n.jsx)(i.h3,{id:"1-libraries-requiring-node_options-for-build",children:"1. Libraries Requiring NODE_OPTIONS for Build"}),"\n",(0,n.jsxs)(i.p,{children:["Some libraries require the ",(0,n.jsx)(i.code,{children:"NODE_OPTIONS=--openssl-legacy-provider"})," prefix for their build script due to compatibility issues with OpenSSL:"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"H5P.Dialogcards"}),": ",(0,n.jsx)(i.code,{children:"1.8.8"}),", ",(0,n.jsx)(i.code,{children:"1.7.10"})]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"H5P.DragQuestion"}),": ",(0,n.jsx)(i.code,{children:"1.15.4"})]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"H5P.DragText"}),": ",(0,n.jsx)(i.code,{children:"1.10.25"}),", ",(0,n.jsx)(i.code,{children:"1.9.5"}),", ",(0,n.jsx)(i.code,{children:"1.8.20"})]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"H5P.MultiMediaChoice"}),": ",(0,n.jsx)(i.code,{children:"0.3.56"})]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"H5P.InteractiveVideo"}),": ",(0,n.jsx)(i.code,{children:"1.28.3"})]}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"2-libraries-requiring-legacy-peer-dependencies-for-npm-install",children:"2. Libraries Requiring Legacy Peer Dependencies for npm install"}),"\n",(0,n.jsxs)(i.p,{children:["Some libraries require the ",(0,n.jsx)(i.code,{children:"--legacy-peer-deps"})," flag for ",(0,n.jsx)(i.code,{children:"npm ci"})," due to peer dependency issues:"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"H5P.DragText"}),": ",(0,n.jsx)(i.code,{children:"1.9.5"}),", ",(0,n.jsx)(i.code,{children:"1.8.20"})]}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"3-libraries-requiring-path-correction-in-libraryjson",children:"3. Libraries Requiring Path Correction in library.json"}),"\n",(0,n.jsxs)(i.p,{children:["Some libraries require correction of file paths in their ",(0,n.jsx)(i.code,{children:"library.json"}),":"]}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"H5P.MemoryGame"}),": ",(0,n.jsx)(i.code,{children:"1.3.36"})]}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"4-libraries-excluded-from-build-steps",children:"4. Libraries Excluded from Build Steps"}),"\n",(0,n.jsx)(i.p,{children:"Some libraries are excluded from build steps (e.g., Shepherd):"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"Shepherd"})," (all versions)"]}),"\n"]}),"\n",(0,n.jsx)(i.h3,{id:"how-special-handling-is-applied",children:"How Special Handling is Applied"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"The build script checks the library name and version against the above lists and applies the necessary build flags or corrections."}),"\n",(0,n.jsx)(i.li,{children:"If a library version is not listed above, it is built using the standard proce"}),"\n"]}),"\n",(0,n.jsx)(i.h2,{id:"output",children:"Output"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"The script downloads and builds H5P libraries into the specified temporary folder."}),"\n",(0,n.jsx)(i.li,{children:"Progress and results are logged to the console."}),"\n"]}),"\n",(0,n.jsx)(i.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsx)(i.li,{children:"Ensure the input and map files exist and are valid YAML."}),"\n",(0,n.jsx)(i.li,{children:"Make sure the temporary folder is writable."}),"\n",(0,n.jsx)(i.li,{children:"Check for errors in the console output for details."}),"\n"]}),"\n",(0,n.jsx)(i.h2,{id:"related-files",children:"Related Files"}),"\n",(0,n.jsxs)(i.ul,{children:["\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"service/h5p-library-builder.service.js"}),": Logic for building libraries"]}),"\n",(0,n.jsxs)(i.li,{children:[(0,n.jsx)(i.code,{children:"helper/file-system.helper.js"}),": File reading utilities"]}),"\n"]}),"\n",(0,n.jsx)(i.hr,{}),"\n",(0,n.jsx)(i.p,{children:"For further details, see inline comments in the script source code."})]})}function h(e={}){const{wrapper:i}={...(0,l.R)(),...e.components};return i?(0,n.jsx)(i,{...e,children:(0,n.jsx)(c,{...e})}):c(e)}},8453:(e,i,r)=>{r.d(i,{R:()=>d,x:()=>a});var s=r(6540);const n={},l=s.createContext(n);function d(e){const i=s.useContext(l);return s.useMemo((function(){return"function"==typeof e?e(i):{...i,...e}}),[i,e])}function a(e){let i;return i=e.disableParentContext?"function"==typeof e.components?e.components(n):e.components||n:d(e.components),s.createElement(l.Provider,{value:i},e.children)}}}]);