"use strict";(self.webpackChunkdataport_docusaurus=self.webpackChunkdataport_docusaurus||[]).push([[9255],{139:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>o,contentTitle:()=>a,default:()=>d,frontMatter:()=>l,metadata:()=>i,toc:()=>c});const i=JSON.parse('{"id":"topics/authentification/concept","title":"Authentification","description":"JWT","source":"@site/docs/topics/authentification/concept.md","sourceDirName":"topics/authentification","slug":"/topics/authentification/concept","permalink":"/docs/topics/authentification/concept","draft":false,"unlisted":false,"editUrl":"https://github.com/hpi-schul-cloud/hpi-schul-cloud.github.io/blob/main/docs/topics/authentification/concept.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Authentification","permalink":"/docs/category/authentification"},"next":{"title":"Authorization","permalink":"/docs/category/authorization"}}');var r=n(4848),s=n(8453);const l={},a="Authentification",o={},c=[{value:"JWT",id:"jwt",level:2},{value:"Structure of a JWT",id:"structure-of-a-jwt",level:3},{value:"1. Header",id:"1-header",level:4},{value:"2. Payload",id:"2-payload",level:4},{value:"3. Signature",id:"3-signature",level:4},{value:"Public/Private Key Signing",id:"publicprivate-key-signing",level:3},{value:"Benefits",id:"benefits",level:3},{value:"Example Flow",id:"example-flow",level:3},{value:"Auto Logout",id:"auto-logout",level:2},{value:"Related Code",id:"related-code",level:2},{value:"Authentification Stategies",id:"authentification-stategies",level:2},{value:"Decorator Example",id:"decorator-example",level:2}];function h(e){const t={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(t.header,{children:(0,r.jsx)(t.h1,{id:"authentification",children:"Authentification"})}),"\n",(0,r.jsx)(t.h2,{id:"jwt",children:"JWT"}),"\n",(0,r.jsx)(t.p,{children:"JSON Web Tokens (JWT) are an open standard (RFC 7519) for securely transmitting information between parties as a JSON object."}),"\n",(0,r.jsx)(t.h3,{id:"structure-of-a-jwt",children:"Structure of a JWT"}),"\n",(0,r.jsxs)(t.p,{children:["A JWT consists of three parts, separated by dots (",(0,r.jsx)(t.code,{children:"."}),"):"]}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"header.payload.signature\n"})}),"\n",(0,r.jsx)(t.h4,{id:"1-header",children:"1. Header"}),"\n",(0,r.jsx)(t.p,{children:"Contains the token type and the signing algorithm used:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",children:'{\n  "alg": "RS256",\n  "typ": "JWT"\n}\n'})}),"\n",(0,r.jsx)(t.h4,{id:"2-payload",children:"2. Payload"}),"\n",(0,r.jsx)(t.p,{children:"Contains the claims (statements about the user):"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-json",children:'{\n  "sub": "userId123",\n  "iat": 1707494400,\n  "exp": 1707498000,\n  "roles": ["student"]\n}\n'})}),"\n",(0,r.jsx)(t.h4,{id:"3-signature",children:"3. Signature"}),"\n",(0,r.jsx)(t.p,{children:"Verifies the integrity of the token:"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:'RSASHA256(\n  base64UrlEncode(header) + "." + base64UrlEncode(payload),\n  privateKey\n)\n'})}),"\n",(0,r.jsx)(t.h3,{id:"publicprivate-key-signing",children:"Public/Private Key Signing"}),"\n",(0,r.jsxs)(t.p,{children:["The Schulcloud uses ",(0,r.jsx)(t.strong,{children:"asymmetric encryption"}),":"]}),"\n",(0,r.jsxs)(t.table,{children:[(0,r.jsx)(t.thead,{children:(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.th,{children:"Key"}),(0,r.jsx)(t.th,{children:"Usage"})]})}),(0,r.jsxs)(t.tbody,{children:[(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"Private Key"})}),(0,r.jsx)(t.td,{children:"Signs the JWT (auth server only)"})]}),(0,r.jsxs)(t.tr,{children:[(0,r.jsx)(t.td,{children:(0,r.jsx)(t.strong,{children:"Public Key"})}),(0,r.jsx)(t.td,{children:"Verifies the JWT (all services)"})]})]})]}),"\n",(0,r.jsx)(t.h3,{id:"benefits",children:"Benefits"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Stateless"}),": No server-side session storage required"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Scalable"}),": Each service can validate tokens independently"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.strong,{children:"Secure"}),": Signature prevents tampering"]}),"\n"]}),"\n",(0,r.jsx)(t.h3,{id:"example-flow",children:"Example Flow"}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{children:"1. Login \u2192 Server creates JWT with Private Key\n2. Client stores JWT\n3. Request + JWT \u2192 Service validates with Public Key\n4. Access granted/denied\n"})}),"\n",(0,r.jsx)(t.h2,{id:"auto-logout",children:"Auto Logout"}),"\n",(0,r.jsx)(t.p,{children:'To handle auto logouts and token refresh for user JWTs, we use Valkey as a "JWT-Session-Store".\nThe user can refresh their JWT until the maximum lifetime of the JWT is reached.'}),"\n",(0,r.jsx)(t.h2,{id:"related-code",children:"Related Code"}),"\n",(0,r.jsx)(t.p,{children:"Authentication"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"https://github.com/hpi-schul-cloud/schulcloud-server/tree/main/apps/server/src/modules/authentication",children:"Authentication Module"})," - Main authentication module"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"https://github.com/hpi-schul-cloud/schulcloud-server/tree/main/apps/server/src/modules/authentication/strategy",children:"Authentication Stategies"})," - Authentication stategies"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"https://github.com/hpi-schul-cloud/schulcloud-client/blob/main/controllers/login.js",children:"Login Controller"})," - Legacy-client-side login controller"]}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"For OAuth"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"https://github.com/hpi-schul-cloud/schulcloud-server/blob/main/apps/server/src/modules/oauth/api/oauth.controller.ts",children:"OAuth Controller"})," - OAuth API controller"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"https://github.com/hpi-schul-cloud/schulcloud-server/blob/main/apps/server/src/modules/oauth-provider/api/oauth-provider.controller.ts",children:"OAuth Provider Controller"})," - OAuth provider API controller"]}),"\n",(0,r.jsx)(t.li,{children:(0,r.jsx)(t.a,{href:"/docs/topics/oauth/concept",children:"Releated OAuth Documentation"})}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"For Ldap\ntbd."}),"\n",(0,r.jsx)(t.p,{children:"Validation decorator"}),"\n",(0,r.jsxs)(t.ul,{children:["\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"https://github.com/hpi-schul-cloud/schulcloud-server/tree/main/apps/server/src/infra/auth-guard",children:"Auth Guard Decorators"})," - Infra module for our NestJS decorators"]}),"\n",(0,r.jsxs)(t.li,{children:[(0,r.jsx)(t.a,{href:"https://github.com/hpi-schul-cloud/schulcloud-server/tree/main/apps/server/src/infra/auth-guard/strategy",children:"Auth Validation Strategies"})," - Validate authentication strategies"]}),"\n"]}),"\n",(0,r.jsx)(t.h2,{id:"authentification-stategies",children:"Authentification Stategies"}),"\n",(0,r.jsx)(t.p,{children:"We have 3 strategies that can be create a SVS JWT"}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"Local - When login credentials are in the SVS."}),"\n",(0,r.jsx)(t.li,{children:"Ldap - We want to login over a external ldap system used in BRB."}),"\n",(0,r.jsx)(t.li,{children:"OAuth - We use a OAuth Flow to login over a external IDM like Moin.Schule (NBC), or TSP."}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"We have 3 base validation strategies."}),"\n",(0,r.jsxs)(t.ol,{children:["\n",(0,r.jsx)(t.li,{children:"For the jwt it self over http."}),"\n",(0,r.jsx)(t.li,{children:"For the jwt but used in web sockets."}),"\n",(0,r.jsx)(t.li,{children:"For x-api-key."}),"\n"]}),"\n",(0,r.jsx)(t.p,{children:"The x-api-key stategy is nearly deprecated and will be replaced with system user logins based on the first strategy."}),"\n",(0,r.jsx)(t.h2,{id:"decorator-example",children:"Decorator Example"}),"\n",(0,r.jsx)(t.p,{children:(0,r.jsx)(t.a,{href:"https://github.com/hpi-schul-cloud/schulcloud-server/blob/main/apps/server/src/modules/me/api/me.controller.ts",children:"MeController Example"})}),"\n",(0,r.jsx)(t.pre,{children:(0,r.jsx)(t.code,{className:"language-typescript",children:"import { JwtAuthentication } from '@infra/auth-guard';\nimport { Controller } from '@nestjs/common';\n\n@JwtAuthentication()\n@Controller('me')\nexport class MeController {\n  // ...\n}\n"})})]})}function d(e={}){const{wrapper:t}={...(0,s.R)(),...e.components};return t?(0,r.jsx)(t,{...e,children:(0,r.jsx)(h,{...e})}):h(e)}},8453:(e,t,n)=>{n.d(t,{R:()=>l,x:()=>a});var i=n(6540);const r={},s=i.createContext(r);function l(e){const t=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(t):{...t,...e}}),[t,e])}function a(e){let t;return t=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:l(e.components),i.createElement(s.Provider,{value:t},e.children)}}}]);