"use strict";(self.webpackChunkdataport_docusaurus=self.webpackChunkdataport_docusaurus||[]).push([[9742],{7277:(e,n,i)=>{i.d(n,{A:()=>s});const s=i.p+"assets/images/login-registrate-user-119dffe591799ef099cffd85f36a25b7.png"},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>r});var s=i(6540);const t={},o=s.createContext(t);function l(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),s.createElement(o.Provider,{value:n},e.children)}},9183:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>a,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"topics/moin-punkt-schule/Getting started","title":"Getting started Moin.Schule","description":"Table of Contents","source":"@site/docs/topics/moin-punkt-schule/Getting started.md","sourceDirName":"topics/moin-punkt-schule","slug":"/topics/moin-punkt-schule/Getting started","permalink":"/docs/topics/moin-punkt-schule/Getting started","draft":false,"unlisted":false,"editUrl":"https://github.com/hpi-schul-cloud/hpi-schul-cloud.github.io/blob/main/docs/topics/moin-punkt-schule/Getting started.md","tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Moin.Schule","permalink":"/docs/category/moinschule"},"next":{"title":"Moin.Schule","permalink":"/docs/topics/moin-punkt-schule/concept"}}');var t=i(4848),o=i(8453);const l={},r="Getting started Moin.Schule",c={},d=[{value:"Table of Contents",id:"table-of-contents",level:2},{value:"General note",id:"general-note",level:2},{value:"Moin.Schule (Development+Reference-instance)",id:"moinschule-developmentreference-instance",level:2},{value:"Localhost configuration",id:"localhost-configuration",level:2},{value:"Done",id:"done",level:3},{value:"Developing on a new dev-branch",id:"developing-on-a-new-dev-branch",level:2},{value:"Special features",id:"special-features",level:2}];function h(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"getting-started-moinschule",children:"Getting started Moin.Schule"})}),"\n",(0,t.jsx)(n.h2,{id:"table-of-contents",children:"Table of Contents"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#getting-started-moinschule",children:"Getting started Moin.Schule"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#table-of-contents",children:"Table of Contents"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#general-note",children:"General note"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#moinschule-developmentreference-instance",children:"Moin.Schule (Development+Reference-instance)"})}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#localhost-configuration",children:"Localhost configuration"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#done",children:"Done"})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#developing-on-a-new-dev-branch",children:"Developing on a new dev-branch"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"#special-features",children:"Special features"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Here we describe how to configure moin.schule for development and test purposes."}),"\n",(0,t.jsx)(n.h2,{id:"general-note",children:"General note"}),"\n",(0,t.jsx)(n.p,{children:"The following applies for testing and production."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"moin.schule is managed completely by N-21 and we have no control over it."}),"\n",(0,t.jsx)(n.li,{children:"If there is any additional feature required or moin.schule is not available, then it needs to be communicated to N-21 directly."}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"moinschule-developmentreference-instance",children:"Moin.Schule (Development+Reference-instance)"}),"\n",(0,t.jsxs)(n.p,{children:["The development and reference environments of SVS in ",(0,t.jsx)(n.em,{children:"nbc space"})," use the ",(0,t.jsx)(n.strong,{children:"testing instance of moin.schule"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"This instance is available via internet. Thus every SVS branch can be configured to work with moin.schule."}),"\n",(0,t.jsxs)(n.p,{children:["For the work with a moin.schule-instance a web application is available. For the ",(0,t.jsx)(n.em,{children:"testing instance"})," of moin.schule the application is available here: ",(0,t.jsx)(n.a,{href:"https://stage.niedersachsen-login.schule/",children:"Moin-Schule-Staging-Web-App"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["Managing moin.schule applications requires a ",(0,t.jsx)(n.strong,{children:"moin.schule-sysadmin account."})]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\u2139\ufe0f moin.schule sysadmin account"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"moin.schule-sysadmin account"})," credentials was made available for dataport. Contact ",(0,t.jsx)(n.em,{children:"DP-DevOps"})," for this topic."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Login to SVS via moin.schule is based on ",(0,t.jsx)(n.strong,{children:"OAuth2"})," procedure therefore an OAuth2 configuration is required."]}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\u2139\ufe0f SVS and moin.schule"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"In SVS moin.schule is managed as an external OAuth2 system."}),"\n",(0,t.jsxs)(n.li,{children:["In moin.schule an SVS server is managed as an external application identified by an unique ",(0,t.jsx)(n.strong,{children:"clientId"})]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"The following parameters are required to establish communication between SVS and moin.schule:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"clientId"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"clientSecret"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.strong,{children:"redirectUrls"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.em,{children:"clientId"})," and ",(0,t.jsx)(n.em,{children:"clientSecret"})," are generated in moin.schule and must be known in SVS."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.em,{children:"redirectUrls"})," refer to SVS branches (servers) which wants to communicate with moin.schule and must be made known in moin.schule."]}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.em,{children:"dBildungscloud-Dev"})," and ",(0,t.jsx)(n.em,{children:"dBildungscloud-Ref"})," are used to manage the redirect URLs. Each application manages a list of redirect-URLs that need to be configured."]}),"\n",(0,t.jsxs)(n.p,{children:["redirect-URLs accepts wildcards. SVS's ",(0,t.jsx)(n.strong,{children:"main"}),"-Branch should be configured by default."]}),"\n",(0,t.jsx)(n.p,{children:"When testing specific branches, the redirect URL of the branch must be added to appropriate application (e.g. to 'dBildungscloud-Dev')."}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Do not forget to remove the URL when the branch is not needed anymore!"})}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"\u2139\ufe0f Enter redirect URLs in moin.schule service"})}),"\n",(0,t.jsx)(n.p,{children:"In order to be able to work with moin.schule from an SVS branch, an appropriate redirect-URL must be configured in moin.schule service."}),"\n",(0,t.jsxs)(n.p,{children:["Example how to define a redirect-URL for a branch: ",(0,t.jsx)(n.code,{children:"https://n21-<branch-name>.nbc.dbildungscloud.dev/*"})]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"localhost-configuration",children:"Localhost configuration"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"In SchulConnex"})}),"\n",(0,t.jsxs)(n.p,{children:["Currently the following alias was defined and configured: ",(0,t.jsx)(n.code,{children:"moin.schule.developer.net"})]}),"\n",(0,t.jsxs)(n.p,{children:["The following 2 RedirectUrls must be configured in Schulconnex (",(0,t.jsx)(n.em,{children:"dBildungscloud-Dev"})," and probably in ",(0,t.jsx)(n.em,{children:"dBildungscloud-Ref"})," done, too) to connect to a local machine:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"http://moin.schule.developer.net:3100/*"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"http://moin.schule.developer.net:4000/*"})}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"In hosts file of the development laptop"})}),"\n",(0,t.jsx)(n.p,{children:"To connect a local server (development laptop) to moin.schule the redirectUrl must be configured that points to a server on the local machine."}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Hint:"})," In the past 'localhost' was used but can not be used anymore due to firewall restriction"]}),"\n",(0,t.jsx)(n.p,{children:"Within the local environment the alias must be made known by adding this entry:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"127.0.0.1 moin.schule.developer.net\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["on Windows: add the line to: ",(0,t.jsx)(n.code,{children:"C:\\Windows\\System32\\drivers\\etc\\hosts"})]}),"\n",(0,t.jsxs)(n.li,{children:["on MacOS: call ",(0,t.jsx)(n.code,{children:"sudo vi /private/etc/hosts"})," and add the line there"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"In .env-file of schulcloud-client and schulcloud-server"})}),"\n",(0,t.jsx)(n.p,{children:"Add or change the following environment variable in both .env-files:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:'HOST="http://moin.schule.developer.net:4000"\nAES_KEY="a-random-string-you-need-to-use-in-step-5"\n'})}),"\n",(0,t.jsxs)(n.p,{children:["You can also use ",(0,t.jsx)(n.strong,{children:"3100"})," instead of ",(0,t.jsx)(n.strong,{children:"4000"}),". Both will work."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Take clientId and clientSecret from 1Password"})}),"\n",(0,t.jsxs)(n.p,{children:["The attributes ",(0,t.jsx)(n.strong,{children:"clientId"})," and ",(0,t.jsx)(n.strong,{children:"clientSecret"})," are stored within ",(0,t.jsx)(n.em,{children:"1Password"}),". For development:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["vault: '",(0,t.jsx)(n.em,{children:"sc-dev-nbc"}),"'"]}),"\n",(0,t.jsx)(n.li,{children:"item: 'server'"}),"\n",(0,t.jsxs)(n.li,{children:["key: '",(0,t.jsx)(n.em,{children:"SANIS_CLIENT_ID"}),"' and '",(0,t.jsx)(n.em,{children:"SANIS_CLIENT_SECRET"}),"'"]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Encrypt the clientSecret with your local AES_KEY (see step 3)"})}),"\n",(0,t.jsx)(n.p,{children:"You need to encrypt SANIS_CLIENT_SECRET using your local AES_KEY (e.g. from .env) and using this script inside of schulcloud_server:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:"node scripts/secret.js -s <AES_KEY> -e <SECRET>\n"})}),"\n",(0,t.jsxs)(n.p,{children:["For the ",(0,t.jsx)(n.strong,{children:"development"}),"-environment the application ",(0,t.jsx)(n.strong,{children:"'dBildungscloud-Dev'"})," is used.\nFor the ",(0,t.jsx)(n.strong,{children:"ref"}),"-environment the application ",(0,t.jsx)(n.strong,{children:"'dBildungscloud-Ref'"})," is used.\nTheir clientId and clientSecret are managed by DevOps."]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Add OAuth2 system configuration to systems-collection of mongoDb"})}),"\n",(0,t.jsx)(n.p,{children:"Please note:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"The configuration is the same as in main!"}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.strong,{children:"clientSecret has to be encrypted with the dev-AES Key"}),' (see section "Dev environment configuration" and "Ref environment configuration")']}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-javascript",children:'{\n  "_id": {\n    "$oid": "0000d186816abba584714c93"\n  },\n  "alias": "moin.schule",\n  "displayName": "moin.schule",\n  "type": "oauth",\n  "provisioningStrategy": "schulconnex-async",\n  "provisioningUrl": "https://api-dienste.stage.niedersachsen-login.schule/v1/person-info",\n  "oauthConfig": {\n    "clientId": "<clientId from e.g. sc-dev-nbc - SCHULCONNEX_CLIENT_CLIENT_ID - see step 4 above>",\n    "clientSecret": "<encrypted clientSecret for: dBildungscloud-Dev from step 5 above>",\n    "tokenEndpoint": "https://auth.stage.niedersachsen-login.schule/realms/SANIS/protocol/openid-connect/token",\n    "grantType": "authorization_code",\n    "scope": "openid",\n    "responseType": "code",\n    "redirectUri": "probably-not-in-use-anymore",\n    "authEndpoint": "https://auth.stage.niedersachsen-login.schule/realms/SANIS/protocol/openid-connect/auth",\n    "provider": "sanis",\n    "jwksEndpoint": "https://auth.stage.niedersachsen-login.schule/realms/SANIS/protocol/openid-connect/certs",\n    "issuer": "https://auth.stage.niedersachsen-login.schule/realms/SANIS",\n    "endSessionEndpoint": "https://auth.stage.niedersachsen-login.schule/realms/SANIS/protocol/openid-connect/logout"\n  }\n}\n'})}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"done",children:"Done"}),"\n",(0,t.jsx)(n.p,{children:"After restarting the server, you should have a new login-system in your client-UI:"}),"\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.img,{alt:"Moin.Schule Login Interface",src:i(7277).A+"",width:"1420",height:"740"})}),"\n",(0,t.jsx)(n.p,{children:'Now you can use this link (or on branch if you are using that) to log into SVS via moin.schule. A list of accounts can be found in the "hu-dev" Vault inside for testing.'}),"\n",(0,t.jsx)(n.h2,{id:"developing-on-a-new-dev-branch",children:"Developing on a new dev-branch"}),"\n",(0,t.jsx)(n.p,{children:"When developing on a dev-branch, you need to add its base-url to the system's configuration in moin.schule."}),"\n",(0,t.jsx)(n.p,{children:"To do so, you have to follow these steps:"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:["Login into: ",(0,t.jsx)(n.a,{href:"https://stage.niedersachsen-login.schule/",children:"https://stage.niedersachsen-login.schule/"}),' using a sysAdmin account (use 1password and start typing "sysAd" to find the right one fohaka...)']}),"\n",(0,t.jsx)(n.li,{children:'Click on "Anwendungen" in the sidebar'}),"\n",(0,t.jsx)(n.li,{children:'Type "dBildungscloud" into the search/filter field'}),"\n",(0,t.jsx)(n.li,{children:'Click on "dBildungscloud-Dev" for dev-environments'}),"\n",(0,t.jsx)(n.li,{children:'Select Tab "Konfiguration"'}),"\n",(0,t.jsx)(n.li,{children:'Click on "+"-Button in the first row of redirect-urls'}),"\n",(0,t.jsx)(n.li,{children:"Enter the url-pattern for your branch in the new text-field at the end of the list (should end with /*)"}),"\n",(0,t.jsx)(n.li,{children:"Click on speichern"}),"\n",(0,t.jsx)(n.li,{children:"Logout as Sysadmin"}),"\n",(0,t.jsx)(n.li,{children:"Login on your dev-branch"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"special-features",children:"Special features"}),"\n",(0,t.jsx)(n.p,{children:"This section describes special features."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"Backchannel Logout URL"})}),"\n",(0,t.jsxs)(n.p,{children:["This URL must be configured within the ",(0,t.jsx)(n.strong,{children:"moin.schule"})," ",(0,t.jsx)(n.strong,{children:"application"})," to enable the logout from SVS during logout from moin.schule."]}),"\n",(0,t.jsxs)(n.p,{children:["The pattern is: ",(0,t.jsx)(n.code,{children:"https://n21-<SVS-branch>.nbc.dbildungscloud.dev/api/v3/logout/oidc"})]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:["\n",(0,t.jsx)(n.p,{children:(0,t.jsx)(n.strong,{children:"EndSession-Endpoint"})}),"\n",(0,t.jsxs)(n.p,{children:["This endpoint is a part of ",(0,t.jsx)(n.strong,{children:"system configuration"})," for moin.schule and is used to logout from moin.schule during logout from SVS client."]}),"\n",(0,t.jsxs)(n.p,{children:["The pattern is: ",(0,t.jsx)(n.code,{children:"https://<moin.schule-URL>/realms/SANIS/protocol/openid-connect/logout"})]}),"\n"]}),"\n"]})]})}function a(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(h,{...e})}):h(e)}}}]);