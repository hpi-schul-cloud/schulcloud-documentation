"use strict";(self.webpackChunkdataport_docusaurus=self.webpackChunkdataport_docusaurus||[]).push([[2867],{8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>i});var o=r(6540);const s={},t=o.createContext(s);function a(e){const n=o.useContext(t);return o.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),o.createElement(t.Provider,{value:n},e.children)}},9251:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>h,frontMatter:()=>a,metadata:()=>o,toc:()=>c});const o=JSON.parse('{"id":"frontend/HowTo","title":"How To","description":"Collection of instructions on how to do certain things:","source":"@site/docs/frontend/4_HowTo.md","sourceDirName":"frontend","slug":"/frontend/HowTo","permalink":"/docs/frontend/HowTo","draft":false,"unlisted":false,"editUrl":"https://github.com/hpi-schul-cloud/hpi-schul-cloud.github.io/blob/main/docs/frontend/4_HowTo.md","tags":[],"version":"current","sidebarPosition":5,"frontMatter":{"sidebar_position":5},"sidebar":"tutorialSidebar","previous":{"title":"Git Conventions","permalink":"/docs/frontend/GitConventions"},"next":{"title":"Writing Tests","permalink":"/docs/frontend/WritingTests"}}');var s=r(4848),t=r(8453);const a={sidebar_position:5},i="How To",l={},c=[{value:"Feature Flags <a></a>",id:"feature-flags-",level:2},{value:"Using generated API and it&#39;s types <a></a>",id:"using-generated-api-and-its-types-",level:2},{value:"Regenerating the clients",id:"regenerating-the-clients",level:3},{value:"Using the generated api",id:"using-the-generated-api",level:3},{value:"User-Permissions on Pages <a></a>",id:"user-permissions-on-pages-",level:2},{value:"Exception handling <a></a>",id:"exception-handling-",level:2},{value:"inject - fallback throwing an error <a></a>",id:"inject---fallback-throwing-an-error-",level:2}];function d(e){const n={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(n.header,{children:(0,s.jsx)(n.h1,{id:"how-to",children:"How To"})}),"\n",(0,s.jsx)(n.p,{children:"Collection of instructions on how to do certain things:"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"HowTo",children:"How To"}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#feature-flags-",children:"Feature Flags "})}),"\n",(0,s.jsxs)(n.li,{children:[(0,s.jsx)(n.a,{href:"#using-generated-api-and-its-types-",children:"Using generated API and it's types "}),"\n",(0,s.jsxs)(n.ul,{children:["\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#regenerating-the-clients",children:"Regenerating the clients"})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#using-the-generated-api",children:"Using the generated api"})}),"\n"]}),"\n"]}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#user-permissions-on-pages-",children:"User-Permissions on Pages "})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#exception-handling-",children:"Exception handling "})}),"\n",(0,s.jsx)(n.li,{children:(0,s.jsx)(n.a,{href:"#inject---fallback-throwing-an-error-",children:"inject - fallback throwing an error "})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,s.jsxs)(n.h2,{id:"feature-flags-",children:["Feature Flags ",(0,s.jsx)("a",{name:"FeatureFlags"})]}),"\n",(0,s.jsx)(n.p,{children:"If there is a new functionality that should only be available on certain systems, we introduce new FEATURE-Flags into the SchulCloud-Backend and into the dof-repository, that contains the configuration for all our instances."}),"\n",(0,s.jsx)(n.p,{children:"Our Vue-Frontend requests all FEATURE-flags and provides global access to them by using this code (example):"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import { useEnvConfig } from "@data-env";\nif (useEnvConfig().value.FEATURE_COPY_SERVICE_ENABLED) {\n    // ...\n}\n'})}),"\n",(0,s.jsxs)(n.h2,{id:"using-generated-api-and-its-types-",children:["Using generated API and it's types ",(0,s.jsx)("a",{name:"UsinggeneratedAPIanditstypes"})]}),"\n",(0,s.jsx)(n.p,{children:"We are using a generator script to create classes to access the Schulcloud-Backend-API - V3 (so Legacy-Backend endpoints (aka V1) are not covered).\nThese generated classes and methods internally use axios to request data and use generated types - both for the input to the methods and for the returned types."}),"\n",(0,s.jsx)(n.h3,{id:"regenerating-the-clients",children:"Regenerating the clients"}),"\n",(0,s.jsx)(n.p,{children:"Only if the server-api or the filestore-api has changed, you need to regenerate them using the following npm-scripts:"}),"\n",(0,s.jsxs)(n.p,{children:["For generating the files to access the ",(0,s.jsx)(n.strong,{children:"server-api"})," please use:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"npm run generate-client:server\n"})}),"\n",(0,s.jsx)(n.p,{children:"The same is implemented for generating the backend-api to our filestore-backend."}),"\n",(0,s.jsxs)(n.p,{children:["For generating the files to access the ",(0,s.jsx)(n.strong,{children:"filestore-api"})," please use:"]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-shell",children:"npm run generate-client:filestorage\n"})}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.strong,{children:"Hint"})}),"\n",(0,s.jsx)(n.p,{children:"For regenerating the clients you need an up-to-date running backend-server running in your environment."}),"\n"]}),"\n",(0,s.jsx)(n.h3,{id:"using-the-generated-api",children:"Using the generated api"}),"\n",(0,s.jsx)(n.p,{children:"The generated APIs can easily be used. Examples can be seen in any current store-implementation - like here:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",metastring:'title="src/store/share-course.ts:"',children:'\nimport {\n ShareTokenApiFactory,\n ShareTokenApiInterface,\n ShareTokenBodyParams,\n ShareTokenBodyParamsParentTypeEnum,\n ShareTokenResponse,\n} from "../serverApi/v3/api";\n\n// ...\n\nexport default class ShareCourseModule extends VuexModule {\n // ...\n private get shareApi(): ShareTokenApiInterface {\n  return ShareTokenApiFactory(undefined, "v3", $axios);\n }\n\n @Action\n async createShareUrl(\n  payload: SharePayload\n ): Promise<ShareTokenResponse | undefined> {\n  const shareTokenPayload: ShareTokenBodyParams = {\n   parentType: ShareTokenBodyParamsParentTypeEnum.Courses,\n   parentId: this.courseId,\n   expiresInDays: payload.hasExpiryDate ? 21 : null,\n   schoolExclusive: payload.isSchoolInternal,\n  };\n  // ...\n  const shareTokenResult =\n   await this.shareApi.shareTokenControllerCreateShareToken(\n    shareTokenPayload\n   );\n  // ...\n }\n    // ...\n}\n\n'})}),"\n",(0,s.jsx)(n.p,{children:"if necessary, you can add a type alias to the api types in order to give them names that are more fitting for your context"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'import {\n    CreateRoomBodyParams,\n    RoomBoardItemResponse,\n    RoomDetailsResponse,\n    RoomItemResponse,\n    UpdateRoomBodyParams,\n    RoomColor as RoomColorEnum,\n} from "@/serverApi/v3";\n\nexport type RoomItem = RoomItemResponse;\nexport type RoomDetails = RoomDetailsResponse;\nexport type RoomBoardItem = RoomBoardItemResponse;\n\nexport type RoomCreateParams = CreateRoomBodyParams;\nexport type RoomUpdateParams = UpdateRoomBodyParams;\n\nexport { RoomColorEnum };\n'})}),"\n",(0,s.jsxs)(n.h2,{id:"user-permissions-on-pages-",children:["User-Permissions on Pages ",(0,s.jsx)("a",{name:"User-PermissionsonPages"})]}),"\n",(0,s.jsxs)(n.p,{children:["The permissions are controlled by ",(0,s.jsx)(n.code,{children:"createPermissionGuard"})," middleware method that receives two parameters. The first parameter should contain an array of the ",(0,s.jsx)(n.code,{children:"userPermission"})," that is required to reach the page. The second parameter is an optional fallback route. If the second parameter isn't provided and the user has no permission to reach the page, an error page ",(0,s.jsx)(n.code,{children:"(401)"})," is shown."]}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'// src/router/routes.ts\n\n// with a fallback route\nconst withFallback = {\n path: "/your/route",\n component: () => import("../pages/your.page.vue"),\n name: "yourRouteName",\n beforeEnter: createPermissionGuard(["ADMIN_VIEW"], "/yourFallBackRoute"),\n}\n\n// without a fallback,\n// it shows a \'401\' file if the user doesn\'t have permissions\nconst withoutFallback = {\n path: "/your/route",\n component: () => import("../pages/your.page.vue"),\n name: "yourRouteName",\n beforeEnter: createPermissionGuard(["ADMIN_VIEW", "SCHOOL_EDIT"]),\n}\n'})}),"\n",(0,s.jsxs)(n.h2,{id:"exception-handling-",children:["Exception handling ",(0,s.jsx)("a",{name:"Exceptionhandling"})]}),"\n",(0,s.jsxs)(n.p,{children:[(0,s.jsx)(n.strong,{children:"useApplicationError"})," is a composable providing a typed factory function for creating application errors.\nA global error handler for putting application errors takes those and puts them into a store and a global error page will display them."]}),"\n",(0,s.jsx)(n.p,{children:"Exceptions should be thrown using them - like this:"}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'// src/pages/user-migration/UserMigration.page.vue\nimport { useApplicationError } from "@/composables/application-error.composable";\n\nconst { createApplicationError } = useApplicationError();\nthrow createApplicationError(HttpStatusCode.BadRequest);\n'})}),"\n",(0,s.jsx)(n.pre,{children:(0,s.jsx)(n.code,{className:"language-typescript",children:'// src/router/guards/permission.guard.ts\nimport { useApplicationError } from "@/composables/application-error.composable";\nimport { applicationErrorModule } from "@/store";\n\nconst { createApplicationError } = useApplicationError();\napplicationErrorModule.setError(createApplicationError(401));\n'})}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsxs)(n.em,{children:["Also look here: ",(0,s.jsx)(n.a,{href:"https://docs.dbildungscloud.de/x/joL4DQ",children:"Meeting Notes 2022-11-25"})]})}),"\n",(0,s.jsxs)(n.h2,{id:"inject---fallback-throwing-an-error-",children:["inject - fallback throwing an error ",(0,s.jsx)("a",{name:"inject-fallbackthrowinganerror"})]}),"\n",(0,s.jsxs)(n.blockquote,{children:["\n",(0,s.jsxs)(n.p,{children:["We want to provide a simple factory function that produces a unique, identifiable error, if an inject fails and we want to avoid adding code to your TypeScript-components only to prevent linter errors.\nThe topic will be implemented with this ticket: ",(0,s.jsx)(n.a,{href:"https://ticketsystem.dbildungscloud.de/browse/BC-2813",children:"Jira - BC-2813"}),". It contains a lot of details on that issue."]}),"\n",(0,s.jsx)(n.p,{children:"... Details should be added here. soon..."}),"\n"]}),"\n",(0,s.jsx)(n.p,{children:(0,s.jsx)(n.em,{children:"Also look here: Frontend Arc Group: Meeting Notes 2022-12-02"})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,s.jsx)(n,{...e,children:(0,s.jsx)(d,{...e})}):d(e)}}}]);