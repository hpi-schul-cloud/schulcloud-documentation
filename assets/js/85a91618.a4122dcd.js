"use strict";(self.webpackChunkdataport_docusaurus=self.webpackChunkdataport_docusaurus||[]).push([[2462],{3905:(e,t,o)=>{o.d(t,{Zo:()=>u,kt:()=>h});var r=o(7294);function n(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function i(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,r)}return o}function a(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?i(Object(o),!0).forEach((function(t){n(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):i(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t){if(null==e)return{};var o,r,n=function(e,t){if(null==e)return{};var o,r,n={},i=Object.keys(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||(n[o]=e[o]);return n}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)o=i[r],t.indexOf(o)>=0||Object.prototype.propertyIsEnumerable.call(e,o)&&(n[o]=e[o])}return n}var l=r.createContext({}),m=function(e){var t=r.useContext(l),o=t;return e&&(o="function"==typeof e?e(t):a(a({},t),e)),o},u=function(e){var t=m(e.components);return r.createElement(l.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},c=r.forwardRef((function(e,t){var o=e.components,n=e.mdxType,i=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),p=m(o),c=n,h=p["".concat(l,".").concat(c)]||p[c]||d[c]||i;return o?r.createElement(h,a(a({ref:t},u),{},{components:o})):r.createElement(h,a({ref:t},u))}));function h(e,t){var o=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var i=o.length,a=new Array(i);a[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[p]="string"==typeof e?e:n,a[1]=s;for(var m=2;m<i;m++)a[m]=o[m];return r.createElement.apply(null,a)}return r.createElement.apply(null,o)}c.displayName="MDXCreateElement"},796:(e,t,o)=>{o.r(t),o.d(t,{assets:()=>l,contentTitle:()=>a,default:()=>d,frontMatter:()=>i,metadata:()=>s,toc:()=>m});var r=o(7462),n=(o(7294),o(3905));const i={},a="Room Member Module",s={unversionedId:"schulcloud-server/our nextjs modules/room-member-module/index",id:"schulcloud-server/our nextjs modules/room-member-module/index",title:"Room Member Module",description:"The Room Member module manages the association between users and rooms, handling permissions and roles within rooms. This module is designed to be injected into the Room module for managing user access and roles within rooms.",source:"@site/docs/schulcloud-server/our nextjs modules/room-member-module/index.md",sourceDirName:"schulcloud-server/our nextjs modules/room-member-module",slug:"/schulcloud-server/our nextjs modules/room-member-module/",permalink:"/docs/schulcloud-server/our nextjs modules/room-member-module/",draft:!1,editUrl:"https://github.com/hpi-schul-cloud/hpi-schul-cloud.github.io/blob/main/docs/schulcloud-server/our nextjs modules/room-member-module/index.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Software Architecture",permalink:"/docs/schulcloud-server/architecture"},next:{title:"How to update the docs",permalink:"/docs/category/how-to-update-the-docs"}},l={},m=[{value:"Model Relationships",id:"model-relationships",level:2},{value:"RoomMemberEntity",id:"roommemberentity",level:3},{value:"GroupEntity",id:"groupentity",level:3},{value:"GroupUserEmbeddable",id:"groupuserembeddable",level:3},{value:"Key Points",id:"key-points",level:2},{value:"Service",id:"service",level:2},{value:"Usage",id:"usage",level:2},{value:"API",id:"api",level:2}],u={toc:m},p="wrapper";function d(e){let{components:t,...i}=e;return(0,n.kt)(p,(0,r.Z)({},u,i,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"room-member-module"},"Room Member Module"),(0,n.kt)("p",null,"The Room Member module manages the association between users and rooms, handling permissions and roles within rooms. This module is designed to be injected into the Room module for managing user access and roles within rooms."),(0,n.kt)("h2",{id:"model-relationships"},"Model Relationships"),(0,n.kt)("p",null,(0,n.kt)("img",{alt:"Room Member Module Relationships",src:o(9806).Z,width:"2089",height:"903"})),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"Room have one RoomMembers"),(0,n.kt)("li",{parentName:"ol"},"RoomMember have one UserGroup"),(0,n.kt)("li",{parentName:"ol"},"UserGroup have many Users"),(0,n.kt)("li",{parentName:"ol"},"Each User in UserGroup have Role")),(0,n.kt)("p",null,"This make room membership easy manage. Can give different roles to users in same room."),(0,n.kt)("h3",{id:"roommemberentity"},"RoomMemberEntity"),(0,n.kt)("p",null,"The core entity of this module is the ",(0,n.kt)("inlineCode",{parentName:"p"},"RoomMemberEntity"),", which represents a user's membership in a room."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript"},"@Entity({ tableName: 'room-members' })\nexport class RoomMemberEntity extends BaseEntityWithTimestamps implements RoomMemberProps {\n    @Property()\n    @Index()\n    roomId!: ObjectId;\n\n    @OneToOne(() => GroupEntity, { owner: true, orphanRemoval: true })\n    userGroup!: GroupEntity;\n\n    @Property({ persist: false })\n    domainObject: RoomMember | undefined;\n}\n")),(0,n.kt)("p",null,"The important part is the ",(0,n.kt)("inlineCode",{parentName:"p"},"userGroup")," property."),(0,n.kt)("p",null,"We store the the members using the ",(0,n.kt)("inlineCode",{parentName:"p"},"Group")," module.\nWhy? => Because that allows us to assign each user a separate role within the room.",(0,n.kt)("br",{parentName:"p"}),"\n","e.g. ROOM_EDITOR, ROOM_VIEWER, ..."),(0,n.kt)("p",null,"These roles are not related to the user's global role."),(0,n.kt)("h3",{id:"groupentity"},"GroupEntity"),(0,n.kt)("p",null,"The ",(0,n.kt)("inlineCode",{parentName:"p"},"userGroup")," property uses the ",(0,n.kt)("inlineCode",{parentName:"p"},"GroupEntity")," from the Group module. This structure allows for multiple users to be associated with a room through a single group."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript"},"class GroupEntity {\n    id: EntityId;\n    name: string;\n    users: GroupUserEmbeddable[];\n    // other properties...\n}\n")),(0,n.kt)("h3",{id:"groupuserembeddable"},"GroupUserEmbeddable"),(0,n.kt)("p",null,"Each user in the group is represented by a ",(0,n.kt)("inlineCode",{parentName:"p"},"GroupUserEmbeddable"),":"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript"},"class GroupUserEmbeddable {\n    user: User;\n    role: Role;\n}\n")),(0,n.kt)("p",null,"This structure allows for flexible assignment of roles to users within the context of a room."),(0,n.kt)("h2",{id:"key-points"},"Key Points"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},"The ",(0,n.kt)("inlineCode",{parentName:"li"},"RoomMemberEntity")," doesn't directly store user IDs or roles. Instead, it uses a ",(0,n.kt)("inlineCode",{parentName:"li"},"GroupEntity")," to manage this information."),(0,n.kt)("li",{parentName:"ol"},"This design allows for easy management of multiple users and roles for a single room."),(0,n.kt)("li",{parentName:"ol"},"The ",(0,n.kt)("inlineCode",{parentName:"li"},"roomId")," is stored directly on the ",(0,n.kt)("inlineCode",{parentName:"li"},"RoomMemberEntity")," for efficient querying of members for a specific room."),(0,n.kt)("li",{parentName:"ol"},"The ",(0,n.kt)("inlineCode",{parentName:"li"},"domainObject")," property facilitates the separation between the database entity and the domain object. This is an optimization to not loose the unit of work using mikro-orm.")),(0,n.kt)("p",null,"This structure provides a flexible and scalable way to manage room memberships, allowing for complex permission and role scenarios within rooms."),(0,n.kt)("h2",{id:"service"},"Service"),(0,n.kt)("p",null,"The ",(0,n.kt)("inlineCode",{parentName:"p"},"RoomMemberService")," is a service for the ",(0,n.kt)("inlineCode",{parentName:"p"},"RoomMember")," entity. It provides methods for creating, updating, and deleting ",(0,n.kt)("inlineCode",{parentName:"p"},"RoomMember")," entities."),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-typescript"},"class RoomMemberService {\n    constructor(private readonly roomMembersRepo: RoomMemberRepo) {}\n}\n")),(0,n.kt)("h2",{id:"usage"},"Usage"),(0,n.kt)("p",null,"The ",(0,n.kt)("inlineCode",{parentName:"p"},"RoomMemberService")," is designed to be injected into the ",(0,n.kt)("inlineCode",{parentName:"p"},"Room")," module for managing user access and roles within rooms."),(0,n.kt)("h2",{id:"api"},"API"),(0,n.kt)("p",null,"There is no API for now. Member specific writes/reads can be implemented by adding an API to the RoomMember module.\nLike adding/removing users to a room."))}d.isMDXComponent=!0},9806:(e,t,o)=>{o.d(t,{Z:()=>r});const r=o.p+"assets/images/p1.excalidraw-8c28bf06109189ad63a5c0b0ee5ab3ec.png"}}]);